import org.opensearch.client.opensearch.OpenSearchClient;
import org.opensearch.client.opensearch.core.PutPolicyRequest;
import org.opensearch.client.opensearch.core.PutPolicyResponse;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import javax.annotation.PostConstruct;
import java.io.IOException;

@Service
public class ISMService {

    @Autowired
    private OpenSearchClient openSearchClient;

    @PostConstruct
    public void createPolicy() {
        try {
            String policyJson = """
            {
                "policy": {
                    "policy_id": "example_policy",
                    "description": "Example ISM policy",
                    "default_state": "hot",
                    "states": [
                        {
                            "name": "hot",
                            "actions": [],
                            "transitions": []
                        }
                    ]
                }
            }
            """;

            var response = openSearchClient.transport().performRequest(
                new Request("PUT", "/_plugins/_ism/policies/example_policy")
                    .setJsonEntity(policyJson)
            );

            if (response.getStatusLine().getStatusCode() == 200) {
                System.out.println("Policy created successfully.");
            } else {
                System.out.println("Failed to create policy: " + response.getStatusLine());
            }
        } catch (IOException e) {
            System.out.println("Failed to create policy: " + e.getMessage());
        }
    }
}
